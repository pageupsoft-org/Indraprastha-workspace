<!-- Product Upsert — final fixed layout (kept dynamic bindings; replaced Descriptions with original block) -->
<div class="min-h-screen w-full bg-gray-100 p-6">
  <div class="max-w-6xl mx-auto">

    <!-- Header -->
    <div class="flex items-center gap-4 mb-6">
      <div class="w-14 h-14 rounded-lg bg-indigo-50 flex items-center justify-center shadow-sm">
        <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7h4l3 9h6l3-12H6"></path>
        </svg>
      </div>

      <div>
        <h2 class="text-xl font-semibold">Create / Edit Product</h2>
        <p class="text-sm text-gray-500 mt-0.5">Add product details, stocks, descriptions, and variants</p>
      </div>

      <div class="ml-auto flex items-center gap-3">
        <button type="button" class="px-4 py-2 rounded border bg-white hover:bg-gray-50 cursor-pointer">Cancel</button>
        <button type="button" class="px-4 py-2 rounded bg-green-600 text-white shadow cursor-pointer">Save
          Product</button>
      </div>
    </div>

    <!-- FORM -->
    <form class="space-y-6" [formGroup]="productForm">

      <!-- Product Basics card -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-medium mb-4">Product Basics</h3>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Name -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Name</label>
            <input formControlName="name" type="text" placeholder="Enter product name"
              class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>

          <!-- Category (single select) -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
            <select formControlName="categoryIds"
              class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
              <option [ngValue]="null" disabled>— Select category —</option>
              @for (item of Categorycombo; track $index) {
              <option [ngValue]="item.id">{{item.name}}</option>
              }
            </select>
          </div>

          <!-- MRP -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">MRP</label>
            <input formControlName="mrp" type="number" placeholder="0.00" step="0.01"
              class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>

          <!-- Gender -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Gender</label>
            <select formControlName="gender"
              class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
              <option [ngValue]="null" disabled>— Select Gender —</option>
              @for (item of genders; track $index) {
              <option [ngValue]="item.key">{{item.value}}</option>
              }
            </select>
          </div>

          <!-- Is Custom Size -->
          <div>
            <label class="inline-flex items-center mt-2">
              <input formControlName="isCustomSize" type="checkbox" class="mr-2 cursor-pointer" />
              <span class="text-sm">Is Custom Size</span>
            </label>
            <input formControlName="customSizeName" type="text" placeholder="Enter custom size name"
              class="mt-2 w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>

          <!-- Color: only color picker + readonly hex (no buttons) -->
          <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Color</label>
            <div class="flex items-center gap-3 mt-2">
              <input type="color" class="w-10 h-10 p-0 m-0 border rounded-full cursor-pointer" />
              <input formControlName="color" type="text" readonly placeholder="#543663"
                class="w-full rounded-lg px-3 py-2 text-sm bg-white border border-slate-200 text-gray-600" />
            </div>
          </div>
        </div>
      </div>

      <!-- Product Stocks card -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium">Product Stocks</h3>
          <button type="button" class="px-3 py-1 rounded bg-blue-600 text-white cursor-pointer" (click)="addStock()">Add
            Stock</button>
        </div>

        <div class="space-y-3" formArrayName="stocks">

          @for (item of productForm.controls.stocks.controls; track $index) {
          <div class="flex gap-3 items-end flex-wrap">
            <div class="flex-1 min-w-[200px]">
              <label class="block text-sm font-medium text-slate-700 mb-1">Quantity</label>
              <input formControlName="quantity" type="number" placeholder="0"
                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>

            <div class="flex-1 min-w-[200px]">
              <label class="block text-sm font-medium text-slate-700 mb-1">Size</label>
              <!-- <input formControlName="size" type="text" placeholder="e.g., S / M / L"
                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" /> -->
              <select formControlName="size"
                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <option [ngValue]="null" disabled>— Select Size —</option>
                @for (item of StockSize; track $index) {
                <option [ngValue]="item.key">{{ item.value }}</option>
                }
              </select>
            </div>

            <button type="button"
              class="px-2 py-1 text-xs rounded border border-red-300 text-red-600 bg-white hover:bg-red-50 cursor-pointer">
              Remove
            </button>
          </div>
          }
        </div>
      </div>

      <!-- ✅ Fixed Descriptions Card Section -->
      <div class="bg-white rounded-lg shadow-lg p-6" formArrayName="descriptions">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium">Descriptions</h3>
          <button type="button" class="px-3 py-1 rounded bg-blue-600 text-white cursor-pointer"
            (click)="addeDiscription()">
            + Add Description
          </button>
        </div>
        <!-- *ngFor="let discription of productForm.controls.descriptions.controls; let i = index" [formGroupName]="i" -->
        <div class="grid gap-4">
          @for (discription of productForm.controls.descriptions.controls; track $index) {
          <div class="relative rounded-lg bg-gray-50 p-4 shadow-sm border border-gray-200 hover:shadow-md transition">
            <!-- Small Remove Button -->
            <button type="button"
              class="absolute top-2 right-2 px-2 py-1 text-xs rounded border border-red-300 text-red-600 bg-white hover:bg-red-50 cursor-pointer">
              ✕
            </button>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Header</label>
                <input formControlName="header" type="text" placeholder="Short heading"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Description Type</label>
                <select formControlName="descriptionType" (change)="setFiled(discription)"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
                  <option [ngValue]="null" disabled>— Select description type —</option>
                  @for (item of discriptionTypeEnum; track $index) {
                  <option [ngValue]="item.key">{{ item.value }}</option>
                  }
                </select>
              </div>
            </div>

            @if(discription.get('descriptionType')?.value == EDiscriptionType.Json){
            <!-- ✅ JSON Description Section -->
            <div class="bg-white rounded-lg shadow-lg p-6" formArrayName="jsonDescription">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-medium">JSON Description</h3>
                <button type="button" class="px-3 py-1 rounded bg-blue-600 text-white cursor-pointer"
                  (click)="createJsonDescritp()">
                  + Add Field
                </button>
              </div>

              <div class="grid gap-4">
                @for (desc of productForm.controls.jsonDescription.controls; track $index) {
                <div
                  class="relative rounded-lg bg-gray-50 p-4 shadow-sm border border-gray-200 hover:shadow-md transition"
                  [formGroup]="desc">

                  <!-- Small Remove Button -->
                  <button type="button"
                    class="absolute top-2 right-2 px-2 py-1 text-xs rounded border border-red-300 text-red-600 bg-white hover:bg-red-50 cursor-pointer">
                    ✕
                  </button>

                  <!-- Key and Value Inputs -->
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                      <label class="block text-sm font-medium text-slate-700 mb-1">Key</label>
                      <input formControlName="key" type="text" placeholder="Enter key"
                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                    </div>

                    <div>
                      <label class="block text-sm font-medium text-slate-700 mb-1">Value</label>
                      <input formControlName="value" type="text" placeholder="Enter value"
                        class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }
            @else{
            <div class="mt-3">
              <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
              <textarea formControlName="description" rows="4" placeholder="Full detailed description"
                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
            </div>
            }


            <div class="mt-3">
              <label class="block text-sm font-medium text-slate-700 mb-1">Short Description</label>
              <input formControlName="shortDescription" type="text" placeholder="One-line summary"
                class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
          </div>
          }

        </div>
      </div>

      <!-- Product Image card -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <label class="block text-sm font-medium text-slate-700 mb-1">Product Image</label>
        <input formControlName="productBase64" type="file" accept="image/*"
          class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white cursor-pointer" />
        <p class="text-xs text-gray-400 mt-1">PNG / JPG / WEBP — max size recommended 2MB</p>
      </div>

      <!-- Product Variants card -->
      <div class="bg-white rounded-lg shadow-lg p-6" formArrayName="variants">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium">Product Variants</h3>
          <button type="button" class="px-3 py-1 rounded bg-blue-600 text-white cursor-pointer" (click)="addVariant()">+
            Add Variant</button>
        </div>
        <div class="grid gap-4">
          @for (item of productForm.controls.variants.controls; track $index) {
          <div class="rounded-lg bg-gray-50 p-4 shadow-sm border border-gray-200 relative hover:shadow-md transition">

            <div class="absolute top-3 right-3">
              <button type="button"
                class="px-2 py-1 text-xs rounded border border-red-300 text-red-600 hover:bg-red-50 cursor-pointer">
                Remove
              </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Variant Name</label>
                <input formControlName="name" type="text" placeholder="e.g., Red - XL"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                <input formControlName="description" type="text" placeholder="Variant specific notes"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">MRP</label>
                <input formControlName="mrp" type="number" placeholder="0.00"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              </div>
            </div>

            <div class="mt-3 grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Quantity</label>
                <input formControlName="quantity" type="number" placeholder="0"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
              </div>

              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Variant Image</label>
                <input formControlName="variantBase64" type="file" accept="image/*"
                  class="w-full border border-slate-200 rounded-lg px-3 py-2 text-sm bg-white cursor-pointer" />
              </div>
            </div>
          </div>
          }
        </div>
      </div>

      <!-- Save buttons -->
      <div class="flex justify-end gap-3">
        <button type="button" class="px-4 py-2 rounded border cursor-pointer">Reset</button>
        <button type="submit" class="px-4 py-2 rounded bg-green-600 text-white shadow cursor-pointer"
          (click)="onProductSubmit()">Save Product</button>
      </div>
    </form>
  </div>
</div>