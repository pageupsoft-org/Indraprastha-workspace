<div class="bg-[#f8f8f8] grid grid-cols-12 gap-6 p-8 pt-0">
  <div class="col-span-6 p-8">
    @if(utilService.AddressData().length){
    <div
      class="bg-white p-5 rounded-2xl border w-full border-gray-100"
      [ngClass]="isViewAllAddress() ? 'border-b-0 rounded-b-none' : ''"
    >
      @for (item of utilService.AddressData(); track $index) { @if($index == 0){

      <p class="text-lg font-semibold text-gray-900">
        Delivering to {{ item.firstName }} {{ item.lastName }}
      </p>

      <!-- Address -->
      <p class="text-sm text-gray-500 mt-1">
        {{ item.address }}, {{ item.city }} - {{ item.pinCode }}
      </p>
      } }

      <!-- Divider -->
      <div class="border-t border-gray-200 my-4"></div>

      <!-- Change Address -->
      @if(utilService.AddressData().length == 1){
      <button
        class="flex items-center gap-1 text-[#680C01] font-medium text-sm cursor-pointer"
        (click)="upsertAddress(0)"
      >
        Add a new delivery address
      </button>
      }@else {
      <button
        class="flex items-center gap-1 text-[#680C01] font-medium text-sm cursor-pointer"
        (click)="toggleViewAllAddress()"
      >
        Change Address
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4"
          [ngClass]="isViewAllAddress() ? 'rotate-180' : 'rotate-0'"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          />
        </svg>
      </button>
      }
    </div>
    @if(isViewAllAddress()){
    <div
      class="space-y-6 p-6 pt-0 bg-white rounded-2xl rounded-t-none border border-gray-100 border-t-0"
      animate.enter="address-enter"
      animate.leave="address-leave"
    >
      @for (item of utilService.AddressData(); track $index) { @if($index > 0){
      <label class="flex items-start gap-3 cursor-pointer">
        <input
          type="radio"
          name="address"
          class="hidden peer"
          [value]="item.id"
          [formControl]="selectedAddress"
          (click)="updatedSelectedAddress($index)"
        />
        <span
          class="w-5 h-5 rounded-full border-2 border-gray-400 flex items-center justify-center peer-checked:border-red-800"
        >
          <span class="w-3 h-3 bg-red-800 rounded-full opacity-0 peer-checked:opacity-100"></span>
        </span>

        <div>
          <p class="text-lg font-semibold text-gray-900">
            Delivering to {{ item?.firstName }} {{ item?.lastName }}
          </p>
          <p class="text-sm text-gray-500">
            {{ item.address }}, {{ item.city }} - {{ item.pinCode }}
          </p>
          <p class="text-sm text-gray-500">Phone No. {{ item.contact }}</p>
          <button
            class="text-[#680C01] font-medium text-sm mt-1 cursor-pointer"
            (click)="upsertAddress(item.id)"
          >
            Edit Address
          </button>
        </div>
      </label>
      } }

      <!-- Divider -->
      <div class="border-t border-gray-200 my-4"></div>

      <!-- Change Address -->
      <button
        class="flex items-center gap-1 text-[#680C01] font-medium text-sm cursor-pointer"
        (click)="upsertAddress(0)"
      >
        Add a new delivery address
      </button>
    </div>
    } } @else {
    <div class="bg-white p-5 rounded-2xl border border-gray-100 w-full">
      <button class="text-lg font-semibold text-gray-900 cursor-pointer" (click)="upsertAddress(0)">
        Add a new delivery address
      </button>
    </div>
    }

    <div class="my-8 bg-white p-5 rounded-2xl border border-gray-100">
      <p class="text-xl font-medium text-gray-800 mb-3">Payment</p>
      <p class="text-sm text-gray-500 mb-4">All transactions are secure and encrypted.</p>
      <div class="border border-gray-300 rounded-md">
        <div class="flex justify-between items-center p-4 border-b border-gray-300">
          <h3 class="font-medium text-gray-800">CCAvenue</h3>
          <div class="flex items-center space-x-2">
            <i class="fab fa-cc-visa text-2xl text-blue-800"></i>
            <i class="fab fa-cc-mastercard text-2xl text-red-600"></i>
            <i class="fab fa-cc-amex text-2xl text-blue-600"></i>
            <span class="text-sm font-medium text-gray-600">+2</span>
          </div>
        </div>
        <div class="bg-gray-50 p-6 text-center">
          <img
            src="https://i.imgur.com/gK2e3pL.png"
            alt="Redirect illustration"
            class="mx-auto mb-4 w-48"
          />
          <p class="text-sm text-gray-600">
            After clicking "Pay now", you will be redirected to CCAvenue to complete your purchase
            securely.
          </p>
        </div>
      </div>
    </div>

    <div class="mt-8">
      <button
        type="submit"
        (click)="onPaymentSumit()"
        class="w-full bg-[#5a1d1c] text-white py-4 px-6 rounded-md font-semibold text-lg hover:bg-opacity-90 transition-colors"
      >
        Pay Now
      </button>
    </div>
    <div class="mt-4">
      <a href="#" class="text-sm text-gray-600 hover:underline"
        >Privacy policy{{ utilService.AddressData().length }}</a
      >
    </div>
  </div>

  <div class="col-span-6 bg-white mt-8 rounded-2xl border border-gray-100">
    <div class="p-4 lg:p-6">
      @for(prod of checkoutData().products; track $index){
      <div class="flex items-start space-x-4 mb-6 hidden">
        <div class="relative">
          <img
            [src]="prod.productURL[0]"
            [alt]="prod.name"
            class="w-20 h-24 object-cover rounded-md border border-gray-200"
          />
        </div>
        <div class="flex-1">
          <h3 class="font-medium text-gray-800">{{ prod.name }}</h3>
          @if(prod.cartVariant && prod.cartVariant.variantId){
          <p class="text-sm text-gray-500">
            {{ prod.cartVariant.name }}
          </p>
          }
          <p class="text-sm text-gray-500">Size: {{ prod.size }} | Color: As shown</p>

          <div
            class="flex items-center justify-center gap-2 mt-2 border border-gray-300 rounded hover:bg-gray-100 w-[100px]"
          >
            <button
              [disabled]="prod.cartQuantity == 1"
              class="w-6 h-6 flex items-center justify-center cursor-pointer"
              [ngClass]="{ 'cursor-not-allowed!': prod.cartQuantity == 1 || prod._isDisable }"
              (click)="alterQuantityCnt(CartUpdateOperation.decrease, $index)"
            >
              âˆ’
            </button>

            <span class="text-sm">{{ prod.cartQuantity }}</span>

            <button
              [disabled]="prod._isDisable"
              class="w-6 h-6 flex items-center justify-center cursor-pointer"
              [ngClass]="{ 'cursor-not-allowed!': prod._isDisable }"
              (click)="alterQuantityCnt(CartUpdateOperation.increase, $index)"
            >
              +
            </button>
          </div>

          <!-- <button
            (click)="removeItemFromCart(prod.cartId, $index)"
            [disabled]="prod._isDisable"
            class="right-0 top-0 p-1 text-gray-400 hover:text-red-500 transition cursor-pointer"
            [ngClass]="{ 'cursor-not-allowed!': prod._isDisable }"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1
           0 00-1-1h-4a1 1 0 00-1 1v3m-4 0h14"
              />
            </svg>
          </button> -->
        </div>

        <div class="flex-1">
          <p class="font-medium text-gray-800 text-end">
            {{ prod.mrp | currency : 'INR' : 'symbol' : '1.0-0' : 'en-IN' }}
          </p>
          @if(prod?.cartVariant && prod?.cartVariant?.variantId){
          <p class="font-medium text-gray-800 text-end">
            {{ prod?.cartVariant?.mrp | currency : 'INR' : 'symbol' : '1.0-0' : 'en-IN' }}
          </p>
          }

          <hr />

          <p class="font-medium text-gray-800 text-end">
            @let sum = (prod.mrp * prod.cartQuantity) +( ((prod?.cartVariant?.mrp) ?
            (prod?.cartVariant?.mrp) : 0) ?? 0);
            {{ sum | currency : 'INR' : 'symbol' : '1.0-0' : 'en-IN' }}
          </p>
        </div>
      </div>

      <app-product-card-size-edit
        [prod]="getDataForCard($index)"
        (alterQty)="alterQuantityCnt($event, $index)"
        (emitDelete)="removeItemFromCart(prod.cartId, $index)"
      ></app-product-card-size-edit>
      }

      <div class="flex space-x-3 mb-6 hidden">
        <input
          type="text"
          placeholder="Discount code"
          class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-gray-800 focus:border-gray-800 outline-none"
        />
        <button
          class="bg-gray-200 text-gray-700 px-6 rounded-md hover:bg-gray-300 font-medium transition-colors"
        >
          Apply
        </button>
      </div>

      <div
        class="flex justify-between items-center mt-4 border-t border-gray-200 pt-4 bg-[#5a1d1c] text-white -mx-6 px-6 py-4 rounded-lg"
      >
        <span class="text-lg font-semibold">Total</span>
        <span class="text-xl font-bold">{{
          total() | currency : 'INR' : 'symbol' : '1.0-0' : 'en-IN'
        }}</span>
      </div>
    </div>
  </div>
</div>
